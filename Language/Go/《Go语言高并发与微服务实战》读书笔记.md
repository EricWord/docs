# 第1章 云原生架构

## 1.1 云计算的历史



# 第2章 微服务概述

## 1. 微服务架构的特点

+ 系统服务层完全独立出来，并将服务层抽取为一个一个的微服务
+ 微服务遵循单一原则
+ 微服务之间采用RESTful等轻量协议通信
+ 微服务一般使用容器技术部署，运行在自己的独立进程中，合理分配其所需的系统资源
+ 每个微服务都有自己独立的业务开发活动和周期

## 2.常见的微服务框架

### 2.1 Spring Cloud

Spring Cloud的子项目大致可以分为两类，一类是对现有成熟框架Spring Boot化的封装和抽象，也是数量最多的项目，如Netflix Eureka、NetFlix Hystrix、Netflix Zuul等；第二类是开发了一部分分布式系统的基础设施的实现，如统一配置管理中心Spring Config.

## 2.2 Dubbo框架

Dubbo是一个分布式服务框架，致力于提供高性能和透明化的RPC远程服务调用方案，以及SOA服务治理方案。简单的说，Dubbo就是个远程服务注册、调用和管理的分布式框架。Dubbo自2008年开始在阿里内部使用，2011年开源，2014年开始停止更新，直至2017年重新开始更新。

特点:

+ 远程通信:提供多种基于长连接的NIO框架的统一抽象封装，支持非阻塞I/O的通信库(比如Mina、Netty、Grizzly)，包括多线程模型、序列化(Hessian2/ProtoBuf)以及请求-响应模式的信息交互方式
+ 集群容错:提供基于接口方法的透明远程过程调用(RPC)，包括多协议支持(自定义RPC协议)以及软负载均衡(Random/RoundRobin)、失败容错(Failover/Failback),地址路由和动态配置等集群支持
+ 自动发现:基于注册中心目录服务器，使服务消费方能动态地查找服务提供方，使地址透明，使服务提供方可以平滑增加或减少机器

## 2.3 Go Kit

Go-kit(gokit.io)是Go语言工具包集合，提供了用于实现系统监控和弹性模式组件的库，例如日志记录、跟踪、限流和熔断等。

基于Go-kit的应用程序架构由三个主要部分组成:传输层、接口层和服务层

1. 传输层用于网络通信，服务通常使用HTTP或gRPC等网络传输方式，或使用NATS等发布订阅系统相互通信，除此之外，Go-kit还支持用AMQP和Thrift等多种网络通信模式
2. 接口层是服务器和客户端的基本构建块。在Go-kit中服务中的每个对外提供的接口方法都会定义为一个端点(Endpoint),以便在服务器和客户端之间进行网络通信。每个端点使用传输层通过使用HTTP或gRPC等具体通信模式对外提供服务
3. 服务层是具体的业务逻辑实现。服务层的业务逻辑包含核心业务逻辑，它不会也不应该进行HTTP或gRPC等具体网络传输或请求和响应西欧阿西类型的编码解码

## 2.4 Go Micro框架

基于Go语言实现的插件化RPC微服务框架，提供了服务发现、负载均衡、同步传输、异步通信以及事件驱动等机制。

Go Micro是组件化的框架，每一个基础功能都有对应的接口抽象，方便扩展，同时组件又是分层的，上层基于下层功能继续向上提供服务。

设计哲学是可拔插的架构理念，提供了可快速构建系统的组件，所有插件可在仓库github.com/micro/go-plugins中找到

## 2.5 Go-kit与Go Micro的对比

Go-kit是一个微服务的标准库，像Go语言一样，Go-kit提供独立的包，通过这些包开发者可以用来组件自己的应用程序。微服务架构意味着构建分布式系统，这带来了许多挑战。Go-kit为多数业务场景下实施微服务软件架构提供指导和解决方案。

Go Micro则是一个面向微服务的可拔插RPC框架，它是只在特殊细分领域上努力的框架，它尝试简化分布式系统之间的通信，所以开发者可以花更多的时间在需要关注的业务逻辑上。



# 第 3章 Go语言基础



# 第4章  Go语言进阶



# 第5章 构建Go Web服务器

## 5.1 Golang Web 框架 Gin





## 5.2 Golang ORM框架 beego实践



# 第6章 服务注册与发现

## 6.1 服务注册于发现的基本原理

服务注册与发现主要包含两部分:服务注册与服务发现。服务注册是指服务实例启动时将自身信息注册到服务注册与发现中心，并在运行时通过心跳等方式向服务注册与发现中心汇报自身服务状态；服务发现是指服务实例向服务注册于发现中心获取其他服务实例信息，用于进行随后的远程调用。

## 6.2 CAP原理

CAP原理是描述分布式系统下节点数据同步的基本定理，C、A、P分别指Consistency(一致性)、Availability(可用性)和Partition tolerance(分区容忍性)，这三个指标不可能同时满足。

1. Consistency,指数据一致性，表示系统的数据信息(包括备份数据)在同一时刻都是一致的。在分布式系统下，同一份数据可能存在于多个不同的实例中，在数据强一致性要求下，对其中一份数据的修改必须同步到它的所有备份中。在数据同步的任何时候，都要保证所有对该份数据的请求将返回同样的状态
2. Availability,指服务可用性，要求服务在接受到客户端的请求后，都能给出响应。服务可用性考量的是系统的可用性，要求系统在高并发和部分节点宕机的情况下，系统整体依然能够响应客户端的请求。
3. Partition tolerance,指分区容忍性。分布式系统中，不同节点之间通过网络进行通信。基于网络的不可靠性，位于不同网络分区的服务节点可能会通信失败，如果系统能够容忍这种情况，说明它是满足分区容忍特性的。如果系统不能够满足分区容忍性，那么将会限制分布式系统的扩展性，即服务节点的部署数量和地区将会受限，违背了分布式系统设计的初衷，所以一般来讲分布式系统都会满足分区容忍性。

在满足了分区容忍性的前提下，分布式系统就不能同时满足数据一致性和服务可用性。假设服务A现在有两个实例A1和A2，他们之间的网络通信出现了异常，基于分区容忍性，这并不会影响A1和A2独立的正常运行。若此时客户端请求A1,请求将数据B从B1状态修改为B2，由于网络的不可用，数据B的修改并不能通知到实例A2。如果此时另一个客户端向A2请求数据B，如果A2返回数据B1，将满足服务可用性，当并不能满足数据一致性；如果A2需要等待A1的通知之后才能返回数据B的正确状态，虽然满足了数据一致性，但无法响应客户端请求，违背了服务可用性的指标。



基于分布式系统的基本特质，分区容忍性是必须要满足的，接下来需要考虑满足数据一致性还是服务可用性，这要取决于具体的应用场景。在类似银行对金额数据要求强一致性的系统中，要优先考虑满足数据一致性；而类似大众网页的系统，用户对网页版本的新旧不会有特别的要求，在这种场景下服务可用性高于数据一致性。

## 6.3 常用的服务注册与发现框架

+ 基于Raft算法的开箱即用微服务发现组件Consul

  由HashiCorp开源，是支持多个平台的分布式高可用系统，使用Go语言实现，主要用于实现分布式系统的服务发现与配置，满足CP特性，是分布式、高可用、可横向扩展的。下载地址:https://www.consul.io/downloads.html

+ 基于HTTP协议的分布式key/value存储组件Etcd

  由CoreOS开源，采用Go语言编写的分布式、高可用的Kye/Value存储系统，主要用于服务发现和配置共享。

+ 重量级一致性服务组件Zookeeper

  作为Hadoop和Hbase的重要组件，是一个开源的分布式应用协调服务，目前由Apache基金会维护，采用Java语言开发。

##  6.4 服务注册与发现组件的对比与选型

![img](E:\Projects\docs\Language\Go\images\4-服务注册与发现组件的对比与选型.png)



# 第7章 远程过程调用RPC



#  第8章 分布式配置中心

## 8.1 分布式配置中心的特性

+ 配置的便捷发布、更新
+ 不同环境配置隔离(开发、测试、预发布和灰度/线上)
+ 配置更新的实时性
+ 高性能、高可用

## 8.2 常见分布式配置中心开源组件

+ Spring Cloud Config

  Spring Cloud 提供的分布式配置中心组件，基于Java语言实现

+ Apllo

  携程框架部门研发的开源配置管理中心，能够集中化管理应用不同环境、不同集群的配置，配置修改后能够实时推送到应用端，并且具备规范的权限控制，流程治理等特性。

+ Disconf

  百度内部使用之后开源，是一套完整的基于Zookeeper的分布式配置统一解决方案

## 8.3 分布式配置中心的对比

![img](E:\Projects\docs\Language\Go\images\5-分布式配置中心的对比.png)



# 第9章 微服务网关

## 9.1 API网关选型

业界有很多流行的API网关，开源的有Nginx、Netflix Zuul、Kong等，当然Kong还有商业版；商业版网关有GoKu API Gateway和Tyk等

+ 标配组件 Nginx 

  可以说是互联网应用的标配组件，主要的使用场景包括负载均衡、反向代理、代理缓存、限流等。

+ Java前置网关服务最佳选型: Netflix Zuul

  Zuul是Netflix开源的微服务网关组件，Java语言编写，可以和Eureka、Ribbon、Hystrix等组件配合使用。

+ 高可用服务网关:Mashape Kong

  Kong 是Mashape开源的高性能、高可用API网关和API服务管理层，是一款基于Nginx_Lua模块开发的高可用服务网关，由于Kong是基于Nginx的，所以可以水平扩展多个Kong服务器。通过前置的负载均衡把请求均匀地分发到各个Server，来应对大批量的网络请求。

## 9.2 三种常用的API网关组件的指标对比

![img](E:\Projects\docs\Language\Go\images\6-常用API网关组件的指标对比.png)



# 第10章 微服务的容错处理与负载均衡



# 第11章 统一认证与授权

## 11.1 常见的认证与授权方案

+ 当前行业授权标准OAuth2

  OAuth2是当前授权的行业标准，其重点在于为Web应用程序、桌面应用程序、移动设备以及室内设备的授权流程提供简单的客户端开发方式。为第三方应用提供对HTTP服务的有限访问，既可以是资源拥有者通过授权允许第三方应用获取HTTP服务，也可以是第三方应用以自己的名义获取访问权限。

+ 数据共享的分布式Session

  实现方案有以下几种:

  ![img](E:\Projects\docs\Language\Go\images\7-分布式session实现方案.png)

+ 安全传输对象JWT

  JWT(JSON Web Token)作为一个开放的标准，通过紧凑(快速传输，体积小)并且自包含(有效负载中将包含用户所需的所有的信息，避免了对数据的多次查询)的方式，定义了用于在各方之间发送的安全JSON对象。



# 第12章 分布式链路追踪

分布式链路追踪就是将一次分布式请求还原成调用链路，将一次分布式请求的调用情况集中展示，比如各个服务节点上的耗时，请求具体到哪台机器上、每个服务节点的请求状态等等。

## 12.1 几种流行的分布式链路追踪组件

+ 简单易上手的Twitter Zipkin

  Zipkin是一款分布式链路追踪组件，由Twitter开源，同样也兼容OpenTracing API

+ 云原生链路监控组件 Uber Jaeger

  Jaeger是CNCF云原生项目之一，Jaeger受Dapper和OpenZipkin的启发，由Uber开源的分布式追踪系统，兼容Open Tracing API。用于微服务的监控和排查，支持分布式上下文传播、分布式事务的监控、报错分析、服务的调用网络分析以及性能/延迟优化。Jaeger的服务端使用Go语言实现，其存储支持Cassandra、Elasticsearch和内存，并提供了Go、Java、Node、Python和C++等语言的客户端库。

+ 探针性能低损耗的SkyWalking

  一个国产的APM开源组件，具有监控、跟踪和诊断云原生架构中分布式系统的功能。

+ 链路统计详细的Pinpoint

  Pinpoint是一个APM工具，适用于用Java/PHP编写的大型分布式系统，Go语言项目不能直接应用Pinpoint，如需使用则需要使用代理进行改造。

+ 4种分布式链路追踪组件的指标对比

  ![img](E:\Projects\docs\Language\Go\images\8-分布式链路追踪组件的指标对比.png)

































