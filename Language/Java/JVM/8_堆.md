# 8.堆

![image-20210512095600977](images/image-20210512095600977.png)



## 8.1 堆的核心概述

![image-20210512095718302](images/image-20210512095718302.png)

![image-20210512100442100](images/image-20210512100442100.png)

### 8.1.1 堆的细分内存结构

![image-20210512101425402](images/image-20210512101425402.png)

![image-20210512101630263](images/image-20210512101630263.png)

![image-20210512101928790](images/image-20210512101928790.png)

## 8.2 设置堆内存大小与OOM

### 8.2.1 堆空间大小的设置

![image-20210512102314373](images/image-20210512102314373.png)

![image-20210512102523231](images/image-20210512102523231.png)

### 8.2.2 OutOfMemory举例

![image-20210512103702942](images/image-20210512103702942.png)

## 8.3 年轻代与老年代

![image-20210512104348440](images/image-20210512104348440.png)

![image-20210512104625326](images/image-20210512104625326.png)

![image-20210512105526469](images/image-20210512105526469.png)

![image-20210512110109870](images/image-20210512110109870.png)

## 8.4 图解对象分配过程

### 8.4.1 对象分配过程：概述

![image-20210512110314933](images/image-20210512110314933.png)

![image-20210512111252942](images/image-20210512111252942.png)

![image-20210512111306666](images/image-20210512111306666.png)

### 8.4.2 总结

![image-20210512111348584](images/image-20210512111348584.png)

### 8.4.3 对象分配的特殊情况

![image-20210512111602486](images/image-20210512111602486.png)

![image-20210512112057653](images/image-20210512112057653.png)

### 8.4.4 常用调优工具

![image-20210512112622084](images/image-20210512112622084.png)

## 8.5 Minor GC、Major GC、Full GC

![image-20210512112935460](images/image-20210512112935460.png)

### 8.5.1 最简单的分代式GC策略的触发条件

![image-20210512113646325](images/image-20210512113646325.png)

![image-20210512113926464](images/image-20210512113926464.png)

![image-20210512114055720](images/image-20210512114055720.png)

![image-20210512114104300](images/image-20210512114104300.png)

## 8.6 堆空间分代思想

![image-20210512122704853](images/image-20210512122704853.png)

![image-20210512122738755](images/image-20210512122738755.png)

## 8.7 内存分配策略(对象提升(Promotion)规则)

![image-20210512123110211](images/image-20210512123110211.png)

![image-20210512123142605](images/image-20210512123142605.png)



## 8.8 为对象分配内存：TLAB

![image-20210512123847924](images/image-20210512123847924.png)

![image-20210512124111358](images/image-20210512124111358.png)

![image-20210512124136216](images/image-20210512124136216.png)

![image-20210512124436387](images/image-20210512124436387.png)

![image-20210512124711862](images/image-20210512124711862.png)

## 8.9 小结堆空间的参数设置

![image-20210512124936270](images/image-20210512124936270.png)

![image-20210512125114206](images/image-20210512125114206.png)

![image-20210512142047006](images/image-20210512142047006.png)

## 8.10 堆是分配对象的唯一选择吗

![image-20210512142553845](images/image-20210512142553845.png)

### 8.10.1 逃逸分析概述

![image-20210512143047383](images/image-20210512143047383.png)

![image-20210512143249043](images/image-20210512143249043.png)

![image-20210512143356150](images/image-20210512143356150.png)

![image-20210512143517518](images/image-20210512143517518.png)

![image-20210512143810083](images/image-20210512143810083.png)

### 8.10.2 逃逸分析：代码优化

![image-20210512143947915](images/image-20210512143947915.png)

![image-20210512144225692](images/image-20210512144225692.png)



### 8.10.3 代码优化之栈上分配

![image-20210512144412921](images/image-20210512144412921.png)

### 8.10.4 代码优化之同步省略(消除)

![image-20210512144923664](images/image-20210512144923664.png)

![image-20210512145032537](images/image-20210512145032537.png)

### 8.10.5 代码优化之标量替换

![image-20210512145332738](images/image-20210512145332738.png)

![image-20210512145540803](images/image-20210512145540803.png)

![image-20210512145959085](images/image-20210512145959085.png)



![image-20210512145700154](images/image-20210512145700154.png)

## 8.11 代码优化及堆的小结



![image-20210512150037573](images/image-20210512150037573.png)

![image-20210512150242798](images/image-20210512150242798.png)



