# 4. 程序计数器

## 4.1 PC Register介绍

![image-20210227175734174](./images/57.png)

 ![image-20210227180005517](./images/58.png)

- 是一块很小的内存空间，几乎可以忽略不计。也是运行速度最快的存储区域。
- 在JVM规范中，每个线程都有自己的程序计数器，是线程私有的，生命周期与线程的生命周期保持一致。
- 任何时间一个线程都只有一个方法在执行，也就是“当前方法”。程序计数器会存储当前线程正在执行的Java方法的JVM指令地址或者如果是在执行native方法，则是未指定值(undefined)
- 是程序控制流的指示器，分支、循环、跳转、异常处理、线程恢复等基础功能都需要依赖这个计数器来完成
- 字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令
- 是唯一一个在Java虚拟机规范中没有规定任何OutOfMemoryError情况的区域



## 4.2 举例说明

![image-20210227180715348](./images/61.png)

![image-20210227181433793](./images/62.png)

## 4.3 两个常见问题

![image-20210227181518487](./images/63.png)

注意上图中两个问题是同一个问题，只是问法不一样



### 4.3.1 PC寄存器为什么会别设定为线程私有？

我们都知道所谓的多线程在一个特定的时间段内只会执行其中某一个线程的方法，CPU会不停地做任务切换，这样必然导致经常中断或恢复，如何保证分毫无差呢？为了能够准确地记录各个线程正在执行的当前字节码指令地址，最好的办法自然是为每一个线程都分配一个PC寄存器，这样一来各个线程之间边可以进行独立计算，从而不会出现相互干扰的情况。

由于CPU时间片轮限制，众多线程在并发执行过程中，任何一个确定的时刻，一个处理器或者多核处理器中的一个内核，只会执行某个线程中的一条指令。

这样必然导致经常中断或恢复，如何保证分毫无差呢？每个线程在创建后，都会产生自己的程序计数器和栈帧，程序计数器在各个线程之间互不影响。

### 4.3.2 CPU时间片



![image-20210227182126803](/Users/cuiguangsong/go/src/docs/Language/Java/JVM/images/65.png)
