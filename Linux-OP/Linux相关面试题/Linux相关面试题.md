# 1. 常用命令

面试题:生产环境服务器变慢，谈谈诊断思路和性能

![image-20210521202106778](images/image-20210521202106778.png)

![image-20210521202310669](images/image-20210521202310669.png)

通过`top`命令主要看两个地方，一个是`CPU/MEM`，另外一个是`load average` 3个数值的含义分别是1分钟、5分钟、15分钟负载，如果3个数相加后除以3，越接近1说明系统负载越高

`uptime`命令是`top`命令的精简版

![image-20210521202529280](images/image-20210521202529280.png)







---

![image-20210521202637391](images/image-20210521202637391.png)

上图数字`2 3`的含义分别是每2秒采样一次，共采样3次，这个命令的结果主要是查看`procs`和`cpu`两个列

![image-20210521202857854](images/image-20210521202857854.png)

![image-20210521202957663](images/image-20210521202957663.png)

![image-20210521203034696](images/image-20210521203034696.png)

![image-20210521203227168](images/image-20210521203227168.png)



---

![image-20210521203440977](images/image-20210521203440977.png)

上图中`pidstat`命令的含义： -u 对于用户每秒钟采用一次，`-p`后接进程id号

---

![image-20210521203638637](images/image-20210521203638637.png)

![image-20210521203728746](images/image-20210521203728746.png)

---

![image-20210521203831794](images/image-20210521203831794.png)

---

![image-20210521203959452](images/image-20210521203959452.png)

![image-20210521204013679](images/image-20210521204013679.png)

---

![image-20210521204155965](images/image-20210521204155965.png)

![image-20210521204223086](images/image-20210521204223086.png)

![image-20210521204232100](images/image-20210521204232100.png)





# 2. CPU占用过高定位思路

面试题:假如生产环境出现CPU占用过高，请谈谈你的分析思路和定位

1. 先用`top`命令找出CPU占比最高的

   ![image-20210521204629198](images/image-20210521204629198.png)

   

2. `ps -ef`或者`jps`进一步定位，得知是一个怎么样的后台程序导致CPU占用过高

   ![image-20210521204832294](images/image-20210521204832294.png)

   

3. 定位到具体线程或者代码

   ![image-20210521204923870](images/image-20210521204923870.png)

   ![image-20210521205015997](images/image-20210521205015997.png)

   ![image-20210521205049699](images/image-20210521205049699.png)

   

4. 将需要的线程id转换为16进制格式(英文小写格式)

   ![image-20210521205142344](images/image-20210521205142344.png)

   

5. `jstack 进程id | grep tid(16进制线程id小写英文) -A60`

